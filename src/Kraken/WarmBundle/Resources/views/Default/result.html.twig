{% extends '::base.html.twig' %}

{% block edit_button %}
    {% if isAuthor %}
        <a class="btn btn-info btn-big pull-right" href="{{ path('start', {slug: calc.slug}) }}">Edytuj informacje o budynku</a>
    {% endif %}
{% endblock %}

{% block body %}
<script>
    window.calculationId = {{ calc.id }};
</script>
{% set powerNeeded = calculator.necessaryStovePower %}
{% set sandCoalPowerNeeded = calculator.necessaryStovePower('sand_coal') %}

<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>{{ punch.phrases.house }}</h1>
    <p class="lead">{{ punch.phrases.heating }}</p>
  </div>
</header>

<div class="container">
  <ul class="nav nav-pills">
    <li class="active"><a href="{{ url('result', {'slug': calc.slug}) }}">Bilans cieplny</a></li>
    <li><a href="{{ url('heaters', {'slug': calc.slug}) }}">Dobór grzejników</a></li>
  </ul>

  {{ block('edit_button') }}

  <div class="page-header">
    <h2>Informacje o budynku <small>{{ building.heatedHouseArea|number_format(0) }}m<sup>2</sup> do ogrzania</small></h2>
  </div>

  <div class="row" id="info">
    <div class="col-md-6">
      <div class="rank">
          <span class="class-badge {{ classifier.classString }}-class">{{ classifier.class }}</span>
          <h3>{{ classifier.classLabel }}</h3>
      </div>
      <p style="text-align:right;font-size:11px"><a href="{{ url('how_it_works') }}#klasyfikacja" target="_blank">Co to znaczy?</a></p>

      <h3>W skrócie o budynku</h3>
      <ul>
      {% for item in houseDescription %}
          <li>{{ item }}</li>
      {% endfor %}
      </ul>
      <p><strong>Lokalizacja:</strong> {{ city.name }} i okolice</p>
      <p><strong>Powierzchnia ogrzewana:</strong> {{ building.heatedHouseArea|number_format(0) }}m<sup>2</sup></p>
    </div>
    <div class="col-md-6">
      <div class="alert alert-success">
          <h4>Pokaż swój wynik innym</h4>
          {% set resultUrl = url('result', {'slug': app.request.get('slug') }) %}
          Możesz później wrócić do tej strony, przesłać komuś te wyniki<br /> lub umieścić na forum. <br />Po prostu skopiuj ten adres: <strong><a href="{{ resultUrl }}">{{ resultUrl }}</a></strong>
      </div>

      <h3>Warunki klimatyczne ({{ city.name }})</h3>
      {% set averageTemperature = heatingSeason.getAverageTemperature(calc) %}
      {% set lastYearAverageTemperature = heatingSeason.getLastYearAverageTemperature(calc) %}
      <p>Przeciętny sezon grzewczy trwa u ciebie ok. <strong>{{ heatingSeason.getSeasonLength(calc) }} dni</strong>, ze średnią temperaturą <strong>{{ averageTemperature|number_format(2, ',', ' ') }}&deg;C</strong>.</p>
      <p>Poprzedni sezon grzewczy trwał ok. <strong>{{ heatingSeason.getLastSeasonLength(calc) }} dni</strong>, ze średnią temperaturą <strong>{{ lastYearAverageTemperature|number_format(2, ',', ' ') }}&deg;C</strong>.</p>
      <div id="climate_chart"></div>
    </div>
  </div>

  <div class="page-header" id="koszty">
    <h2>Koszty i efektywność ogrzewania</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
        <h3>Jak obecnie ogrzewasz</h3>
          <dl>
          {% set fuelInfoProvided = calc.fuelType and calc.fuelConsumption %}
          {% set stoveEfficiency = fuelInfoProvided ? calculator.yearlyStoveEfficiency*100 : 0 %}
          {% if calc.stovePower %}
            <dt>{{ label_success(calc.stovePower|number_format(0, ',', ' ') ~ 'kW') }}</dt>
            <dd>moc nominalna twojego kotła</dd>
            {% if calculator.isStoveOversized and (not fuelInfoProvided or stoveEfficiency < 40) %}
                <div class="alert alert-danger">
                  <h4>Zbyt duża moc kotła drenuje ci portfel</h4>
                  Przez ten zbędny zapas mocy płacisz za opał, który bez pożytku ucieka kominem.
                  <a href="http://czysteogrzewanie.pl/zakupy/mocy-przybywaj-dobor-mocy-kotla-weglowego/#Co_zrobi_z_przewymiarowanym_kotem" target="_blank">Zobacz, dlaczego tak jest i jak to tanio naprawić</a>.
                </div>
            {% endif %}
          {% endif %}
            <dt>{{ calc.indoorTemperature|number_format(1, ',', ' ') }}&deg;C</dt>
            <dd>średnia temperatura w domu w ciągu zimy</dd>
          {% if fuelInfoProvided %}
            <dt>{{ calc.fuelLabel }}</dt>
            <dd>zużycie paliwa w sezonie grzewczym</dd>
          {% endif %}
          </dl>
          {% if fuelInfoProvided %}
            {% if calc.usingSolidFuel %}
                {% if stoveEfficiency < 35 %}
                  <div class="alert alert-danger">
                      <h4>Ogrzewanie rujnuje twój budżet</h4>
                      Sprawność twojej instalacji grzewczej to <strong>marne ~{{ stoveEfficiency|number_format(0, ',', ' ') }}%</strong>.
                      To znaczy, że większość pieniędzy wydanych na ogrzewanie wyrzucasz w błoto!
                      <br />Na szczęście możesz szybko i prawie za darmo zacząć oszczędzać.
                      <br /><a href="http://czysteogrzewanie.pl/jak-palic-w-piecu/jak-palic-czysto-weglem/" target="_blank">Przeczytaj, jak palić ekonomicznie i wygodnie</a>.
                  </div>
                {% elseif stoveEfficiency < 50 %}
                  <div class="alert alert-warning">
                      <h4>Sporo przepłacasz za ogrzewanie</h4>
                      Sprawność twojej instalacji grzewczej to <strong>tylko ~{{ stoveEfficiency|number_format(0, ',', ' ') }}%</strong>.
                      <br /><a href="http://czysteogrzewanie.pl/jak-palic-w-piecu/jak-palic-czysto-weglem/" target="_blank">Zobacz, jak palić ekonomicznie oraz wygodnie i zacznij oszczędzać od zaraz!</a>
                  </div>
                {% elseif stoveEfficiency < 75 %}
                  <div class="alert alert-info">
                      <h4>Ogrzewanie jest dość efektywne</h4>
                      Sprawność twojej instalacji grzewczej to <strong>~{{ stoveEfficiency|number_format(0, ',', ' ') }}%</strong>.
                  </div>
                {% elseif stoveEfficiency < 90 %}
                  <div class="alert alert-success">
                      <h4>Ogrzewanie jest bardzo efektywne</h4>
                      Sprawność twojej instalacji grzewczej to <strong>aż ~{{ stoveEfficiency|number_format(0, ',', ' ') }}%</strong>.
                  </div>
                {% endif %}
            {% else %}
                {% if stoveEfficiency < 75 %}
                  <div class="alert alert-warning">
                      <h4>Ogrzewanie jest nieefektywne</h4>
                      Sprawność twojej instalacji grzewczej to <strong>tylko ~{{ stoveEfficiency|number_format(0, ',', ' ') }}%</strong>. To mało jak na {{ calc.fuelType == 'electricity' ? 'prąd' : 'gaz' }}.
                      Być może podałeś zbyt duże aktualne zużycie energii. Jeśli grzejesz także wodę użytkową, odejmij od rachunku 10-20%.
                  </div>
                {% elseif stoveEfficiency < 110 %}
                  <div class="alert alert-success">
                      <h4>Ogrzewanie jest bardzo efektywne</h4>
                      Sprawność twojej instalacji grzewczej to <strong>aż ~{{ stoveEfficiency|number_format(0, ',', ' ') }}%</strong>. Znakomicie.
                  </div>
                {% endif %}
            {% endif %}
            {% set fuelComparison = comparison.compareFuelConsumption %}
            {% if fuelComparison %}
                <div class="alert alert-info">
                    <h4>Jak to wygląda u innych?</h4>
                    {{ fuelComparison|raw }}
                </div>
            {% endif %}
          {% else %}
            <div class="alert alert-danger">
                <strong>Niestety</strong> nie podałeś kosztów ogrzewania, więc nie powiemy ci nic na ten temat.
            </div>
          {% endif %}
    </div>
    <div class="col-md-6">
        <h3>Ile ciepła zużywa twój dom</h3>
        <dl>
          <dt>{{ label_success((calculator.maxHeatingPower/1000)|number_format(1, ',', ' ') ~ 'kW') }}</dt>
          <dd>takiej mocy grzewczej potrzebuje twój dom w największy mróz</dd>
          <dt>{{ calculator.maxHeatingPowerPerArea|number_format(0, ',', ' ') }}W/m<sup>2</sup></dt>
          <dd>wskaźnik mocy kotła względem ogrzewanego metrażu</dd>
          <dt>{{ calculator.yearlyEnergyConsumption|number_format(0, ',', ' ') }}kWh</dt>
          <dd>tyle ciepła zużyje dom w ciągu całego sezonu grzewczego</dd>
          <dt>{{ calculator.yearlyEnergyConsumptionFactor|number_format(0, ',', ' ') }}kWh/m<sup>2</sup>*rok</dt>
          <dd>zużycie roczne energii w przeliczeniu na 1m<sup>2</sup> - zalicza twój dom do klasy energetycznej&nbsp;{{ classifier.class }}</dd>
        </dl>
        <h4>W najmroźniejszy dzień zimy <small>średnia dobowa {{ heatingSeason.getLowestTemperature()|number_format(0, ',', ' ') }}&deg;C na zewnątrz</small></h4>
        <dl>
          <dt>{{ label_success((calculator.maxHeatingPower/1000)|number_format(1, ',', ' ') ~ 'kW') }}</dt>
          <dd>potrzebna moc grzewcza</dd>
        </dl>
        <h4>W przeciętny dzień zimy <small>{{ heatingSeason.getAverageTemperature()|number_format(1, ',', ' ') }}&deg;C na zewnątrz</small></h4>
        <dl>
          <dt>{{ label_success((calculator.avgHeatingPower/1000)|number_format(1, ',', ' ') ~ 'kW') }}</dt>
          <dd>potrzebna moc grzewcza</dd>
        </dl>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <h3>Podział strat ciepła</h3>
      <div id="heat_loss_breakdown"></div>
    </div>
    <div class="col-md-6">
      <h3>W co zainwestować, by taniej ogrzewać?</h3>
      {% set variants = upgrade.variants %}
      {% if variants %}
        <dl>
          {% for item in variants %}
          <dt>{{ label_warning(item.gain * 100 ~ '%') }} taniej</dt>
          <dd>{{ item.title|raw }}</dd>
          {% endfor %}
        </dl>
      {% else %}
      <p>Dom jest dobrze ocieplony. Za rozsądne pieniądze nic tu nie poprawisz.</p>
      {% endif %}
    </div>
  </div>

  <div class="page-header" id="rady">
    <h2>Jak żyć</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3>Czym i za ile ogrzewać</h3>
      <p>Tyle będzie kosztowało utrzymanie w domu temperatury {{ calc.indoorTemperature|number_format(1, ',', ' ') }}&deg;C przez cały sezon grzewczy.</p>
      <div class="alert alert-info">
          W wyliczeniach przyjęto orientacyjne ceny paliw. Aby wyniki lepiej pasowały do twojej sytuacji, w każdej chwili <a href="#custom_fuel_prices" data-toggle="modal"><strong>możesz zmienić ceny paliw</strong></a>.</p>  
      </div>  
        <div id="fuel_chart" style="height:600px"></div>
        <p><small><strong>Kopcenie węglem</strong> to palenie "od dołu" w kotle górnego spalania, czego efektem jest <a href="http://czysteogrzewanie.pl/wp-content/uploads/2013/01/kopcur.jpg" target="_blank">syf</a> oraz wysokie koszty (lub niedogrzanie domu).<br />
            <strong>Ekonomiczne spalanie</strong> to palenie "od góry" w kotle górnego spalania lub zgodnie z instrukcją w kotle dolnego spalania.<br />
            <strong>Cena prądu</strong> dotyczy strefy II ("nocnej") w taryfie dwustrefowej.</small>
        </p>
        <div id="custom_fuel_prices" class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <a class="close" data-dismiss="modal">&times;</a>
                <h3>Ceny paliw i koszt pracy</h3>
              </div>
              <div class="modal-body">
                <p>Poniżej możesz podać ceny paliw dostępnych w twojej okolicy oraz cenę godziny twojej pracy w kotłowni, aby otrzymać bardziej realne podsumowanie kosztów ogrzewania.</p>
                <div id="custom_fuel_prices2">
                  <form role="form">
                  <div class="form-group">
                      <label for="work_hour_cost" class="required control-label">Cena twojej pracy:</label>
                      <div class="input-group">
                          <input type="text" id="work_hour_cost" name="work_hour_cost" value="{{ pricing.defaultWorkHourPrice }}" class="form-control" />
                          <span class="input-group-addon">zł/h</span>
                      </div>
                  </div>
                      {% for fuel in fuels %}
                      <div class="form-group">
                          <label for="fuel_{{ fuel.type }}" class="required control-label">{{ fuel.name }}:</label>
                          <div class="input-group">
                                <input type="text" id="fuel_{{ fuel.type }}" name="fuel_{{ fuel.type }}" value="{{ fuel.price * fuel.tradeAmount }}" class="form-control" />
                                <span class="input-group-addon">zł/{{ fuel.tradeUnit }}</span>
                          </div>
                      </div>
                      {% endfor %}
                  </form>
                </div>
              </div>
              <div class="modal-footer">
                <a href="#" class="btn" data-dismiss="modal">Zamknij</a>
                <a href="#" class="btn btn-primary" id="update_fuels">Przelicz koszty</a>
              </div>
            </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <h3>Jakie ogrzewanie jest najbardziej opłacalne?</h3>

      <p>Oto sposoby ogrzewania, które są najtańsze w użyciu, a wydatek na ich zakup zwróci się najszybciej.</p>

      <div class="panel panel-success" ng-repeat="variant in heatingVariants | filter: greaterThan('savedMoney', 0)">
        <div class="panel-heading">{[{ variant.label }]}&nbsp;<small>{[{ variant.version }]}</small></div>
        <div class="panel-body">
          Koszt instalacji: ~{[{ variant.setup_cost|currency }]}<br />
          Roczna oszczędność: <strong>{[{ variant.savedMoney|currency }]}</strong> oraz {[{ variant.savedTime|number }]} godzin pracy<br />
          Czas zwrotu inwestycji: <strong>{[{ formatRoiPeriod(variant.roi) }]}</strong><br />
        </div>
      </div>

    </div>
  </div>

  {{ block('edit_button') }}
</div>

{% endblock %}

{% block javascripts %}
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.10/angular.min.js"></script>
  <script src="https://code.angularjs.org/1.3.0-beta.10/i18n/angular-locale_pl.js"></script>
{% endblock %}

{% block bottom_javascripts %}
<script src="{{ asset('bundles/krakenwarm/js/vendor/highcharts.js') }}"></script>
<script src="{{ asset('bundles/krakenwarm/js/result.js') }}"></script>
{% endblock %}
